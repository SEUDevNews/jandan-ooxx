!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";i(1),i(2),i(3),i(4),i(5),i(6)},function(e,t){"use strict";t.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(e,t,i){"use strict";var n=i(1).app;n.config(["$urlRouterProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("","/").otherwise("/")}]),n.config(["$stateProvider",function(e){e.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("index.image",{url:"{id:int}",controller:"ImageController",templateUrl:"/public/views/image.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"})}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval","$location",function(e,t,i,n,o,a,r){o.$default({autoChange:!1,autoShowHelpInfo:!0,imagesHistory:[]}),e.autoChange={status:o.autoChange,interval:null},e.setAutoChange=function(){o.autoChange=e.autoChange.status},e.historyIndex=!1,e.setHistoryIndex=function(t){e.historyIndex=t},e.index=0,e.setIndex=function(t){e.index=t},e.images=[],e.openMenu=function(){t("left").toggle()},e.helpDialog={autoShow:o.autoShowHelpInfo},e.setHelpInfo=function(){o.autoShowHelpInfo=e.helpDialog.autoShow},e.showHelpDialog=function(){e.dialog=n.show({preserveScope:!0,scope:e,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},e.closeDialog=function(){n.hide(e.dialog)},e.menus=[{name:"首页",icon:"home",click:function(){r.path().match(/^\/\d{1,}$/)||i.go("index")}},{name:"浏览记录",icon:"history",click:function(){return i.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return e.showHelpDialog()}},{name:"关于本项目",icon:"code",click:function(){window.location="https://github.com/gyteng/jandan-ooxx"}}],e.menuClick=function(i){e.menus[i].click(),t("left").close()},e.$on("$stateChangeStart",function(t,i,n,o,r,s){"index.image"===o.name&&"index.image"!==i.name&&e.autoChange.interval&&a.cancel(e.autoChange.interval)})}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("IndexController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage","$location",function(e,t,i,n,o,a,r,s){r.autoShowHelpInfo&&!e.historyIndex&&e.showHelpDialog(),e.progress={circular:0};var l=function(){return e.progress.circular=0,a(function(){e.progress.circular+=1,e.progress.circular>=100&&(e.progress.circular=0,e.random(!0))},100)},g=!1;e.getImages=function(){return e.images.length>15||g?Promise.resolve():(g=!0,t.get("/random").then(function(t){return g=!1,e.images.length||(r.imagesHistory.push(t.data),e.setIndex(0)),e.images.push(t.data),e.getImages(),Promise.resolve()}).catch(function(){return o(function(){g=!1,e.getImages()},2e3),Promise.reject()}))},e.historyIndex?(e.images[0]={id:r.imagesHistory[e.index].id,url:r.imagesHistory[e.index].url},e.setHistoryIndex(!1),i.go("index.image",{id:e.images[0].id})):"/"!==s.path()?i.go("index.image",{id:+s.path().substr(1)}):e.images[0]?i.go("index.image",{id:e.images[0].id}):e.getImages().then(function(){i.go("index.image",{id:e.images[0].id})}),e.getImages(),e.random=function(t){e.getImages(),e.images.splice(0,1),e.images[0]&&r.imagesHistory.push(e.images[0]),r.imagesHistory.length>60&&r.imagesHistory.splice(0,r.imagesHistory.length-60),e.setIndex(r.imagesHistory.length-1),t||(e.autoChange.interval&&a.cancel(e.autoChange.interval),e.autoChange.status&&(e.autoChange.interval=l())),i.go("index.image",{id:e.images[0].id})},e.next=function(){e.index<r.imagesHistory.length-1?(e.setIndex(e.index+1),e.images[0]=r.imagesHistory[e.index],i.go("index.image",{id:e.images[0].id})):e.random()},e.prev=function(){e.index>0&&(e.setIndex(e.index-1),e.images[0]=r.imagesHistory[e.index],i.go("index.image",{id:e.images[0].id}))},e.$watch("autoChange.status",function(){return e.autoChange.status?void(e.autoChange.interval=l()):void(e.autoChange.interval&&a.cancel(e.autoChange.interval))})}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("ImageController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage",function(e,t,i,n,o,a,r){var s=n.id;s||(n.id=1),e.currentImage=e.images.filter(function(e){return e.id===s})[0],e.currentImage||t.get("/image/"+s).then(function(t){e.currentImage=t.data})}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(e,t,i,n){return t.imagesHistory?(e.divHeightStyle={height:100/3+"vw"},n("md")&&(e.divHeightStyle.height="25vw"),n("gt-md")&&(e.divHeightStyle.height=100/6+"vw"),e.history=t.imagesHistory.map(function(e){return{id:e.id,url:e.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),e.history.forEach(function(t,i){var n=new Image;n.onload=function(){e.history[i].width=n.width,e.history[i].height=n.height,n.height<n.width&&(e.history[i].style={height:"100%","max-width":"none","min-width":100/t.height*t.width+"%"})},n.src=t.url}),void(e.toImage=function(t){e.setHistoryIndex(!0),e.setIndex(t),i.go("index")})):i.go("index")}])}]);